<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Billions-Rush</title>
<style>
:root{
    --bg1: #0a0a0a;
    --bg2: #1a0a2e;
    --accent: #00f7ff;
    --accent-2: #7c3aed;
    --text: #cffcff;
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto;
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    color: var(--text);
    display:flex;flex-direction:column;align-items:center;padding:20px;
}

#scoreboard {
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(16px);
    background: linear-gradient(145deg, rgba(31,41,55,0.9), rgba(31,41,55,0.6));
    box-shadow: 0 10px 25px rgba(0,0,0,0.5), 0 0 15px rgba(0,255,255,0.2) inset;
    border-radius: 18px;
    display:flex;
    flex-direction: column;
    align-items: center;
    padding: 16px 24px;
    gap: 12px;
}
#scoreboard .top-row {
    display:flex;
    justify-content: space-between;
    width: 100%;
    align-items: center;
}
#scoreboard h1 {
    font-size: 2rem;
    text-shadow: 0 0 8px var(--accent), 0 0 12px var(--accent-2);
}
#scoreboard .stats {
    display:flex;
    justify-content: space-around;
    width: 100%;
    padding: 12px 0;
    background: rgba(0,0,0,0.2);
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4) inset;
}
#scoreboard .stats span {
    font-size: 1.1rem;
    font-weight: bold;
    color: var(--text);
    padding: 6px 12px;
    border-radius: 8px;
    background: rgba(255,255,255,0.05);
    box-shadow: 0 2px 8px rgba(0,255,255,0.2);
    transition: transform 0.25s ease-out, color 0.25s ease-out;
}
.value-animate.bump {transform: scale(1.3); color: #00ff9d;}

#game-board{
    width:380px;height:380px;
    display:grid;
    grid-template-columns:repeat(8,1fr);
    gap:6px;padding:10px;
    background:#111;border-radius:12px;position:relative;
}

.gem{
    width:100%;height:100%;border-radius:8px;cursor:pointer;
    display:flex;justify-content:center;align-items:center;
    transition:transform 0.15s ease;
    position:relative;
    touch-action: none;
}
.gem img{
    width:90%;height:90%;object-fit:contain;
    filter:drop-shadow(0 0 4px rgba(0,255,255,0.3));
}
.gem.selected{transform:scale(1.15);box-shadow:0 0 12px var(--accent);}
.gem.click-bounce {animation: clickBounce .25s ease-out;}
@keyframes clickBounce {0%{transform:scale(1)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
.gem.matched{animation: explode .45s forwards}
@keyframes explode{0%{transform:scale(1);opacity:1}100%{transform:scale(0);opacity:0}}
.rare {animation: rareGlow 1.8s infinite ease-in-out;}
@keyframes rareGlow {0%{filter:drop-shadow(0 0 4px #7c3aed)}50%{filter:drop-shadow(0 0 12px #b794f4)}100%{filter:drop-shadow(0 0 4px #7c3aed)}}
.diagonal-glow {box-shadow: 0 0 16px #ff00ff, 0 0 24px #ff00ff inset;}

.btn{padding:12px 20px;font-weight:700;border-radius:10px;color:white}
.btn-start{background:#22c55e}
.btn-end{background:#dc2626}

#particle-canvas{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;}
</style>
</head>
<body>

<div id="scoreboard">
    <div class="top-row">
        <h1>BILLIONS RUSH</h1>
        <span class="value-animate">Level: 1</span>
    </div>
    <div class="stats">
        <span>Score: <span id="score" class="value-animate">0</span></span>
        <span>Moves: <span id="moves" class="value-animate">0</span></span>
        <span>Combo: <span id="combo" class="value-animate">0</span></span>
    </div>
</div>

<div id="game-board"></div>

<div class="w-full max-w-3xl flex justify-between mt-4">
    <button id="end-game" class="btn btn-end">END GAME</button>
    <button id="start-game" class="btn btn-start">START GAME</button>
</div>

<canvas id="particle-canvas"></canvas>

<script>
let game = {size:8, board:[], score:0, moves:30, combo:0, isStarted:false};
let firstGem=null;
const boardEl = document.getElementById("game-board");
const particleCanvas = document.getElementById("particle-canvas");
const ctx = particleCanvas.getContext("2d");
particleCanvas.width = window.innerWidth;
particleCanvas.height = window.innerHeight;
let particles = [];

// Particle system
function spawnParticles(x,y){
    for(let i=0;i<18;i++){ particles.push({x,y,dx:(Math.random()*4-2),dy:(Math.random()*4-2),life:28}); }
}
function animateParticles(){
    ctx.clearRect(0,0,particleCanvas.width,particleCanvas.height);
    particles.forEach(p=>{
        p.x+=p.dx; p.y+=p.dy; p.life--;
        ctx.globalAlpha=p.life/28;
        ctx.beginPath(); ctx.arc(p.x,p.y,4,0,Math.PI*2); ctx.fillStyle="white"; ctx.fill();
    });
    particles = particles.filter(p=>p.life>0);
    requestAnimationFrame(animateParticles);
}
animateParticles();

// Game setup
function initGame(){
    game.board=[]; game.score=0; game.moves=30; game.combo=0; game.isStarted=true; firstGem=null;
    generateBoard(); renderBoard(); updateDisplay();
}
function generateBoard(){
    const imgs=["gem1.png","gem2.png","gem3.png","gem4.png","gem5.png","gem6.png"];
    for(let r=0;r<game.size;r++){ game.board[r]=[];
        for(let c=0;c<game.size;c++){
            let img=imgs[Math.floor(Math.random()*imgs.length)];
            game.board[r][c]={img, rare:Math.random()<0.1};
        }
    }
}

// Render gems
function renderBoard(){
    boardEl.innerHTML="";
    const gemSize = boardEl.clientWidth / game.size;
    for(let r=0;r<game.size;r++){
        for(let c=0;c<game.size;c++){
            const gem=document.createElement("div");
            gem.className="gem";
            gem.style.transform=`translate(0,0)`; 
            const img=document.createElement("img");
            img.src=`Assets/${game.board[r][c].img}`;
            if(game.board[r][c].rare) img.classList.add("rare");
            gem.appendChild(img);
            gem.dataset.row=r; gem.dataset.col=c;

            // Add both tap and swipe
            gem.onclick=()=> selectGem(r,c,gem);
            addSwipeEvents(gem, r, c, gemSize);

            boardEl.appendChild(gem);
        }
    }
}

// Tap-to-select
function selectGem(r,c,gemEl){
    if(!game.isStarted) return;
    gemEl.classList.add("click-bounce");
    setTimeout(()=>gemEl.classList.remove("click-bounce"),250);
    const gems=document.querySelectorAll('.gem'); gems.forEach(g=>g.classList.remove('selected'));
    if(!firstGem){
        firstGem={r,c};
        gemEl.classList.add('selected');
    }else{
        swapGemsAnimated(firstGem.r,firstGem.c,r,c);
        firstGem=null;
    }
}

// Swipe logic with smooth slide
function addSwipeEvents(el,r,c,gemSize){
    let startX, startY, isDragging=false;
    el.addEventListener('mousedown', e=>{ startX=e.clientX; startY=e.clientY; isDragging=true; });
    el.addEventListener('touchstart', e=>{ const t=e.touches[0]; startX=t.clientX; startY=t.clientY; isDragging=true; });
    function endDrag(e){
        if(!isDragging) return;
        let endX = e.clientX || (e.changedTouches ? e.changedTouches[0].clientX : startX);
        let endY = e.clientY || (e.changedTouches ? e.changedTouches[0].clientY : startY);
        let dx = endX - startX, dy = endY - startY;
        if(Math.abs(dx)<20 && Math.abs(dy)<20){ isDragging=false; return; }
        let targetR=r+(dy>0?1:dy<0?-1:0), targetC=c+(dx>0?1:dx<0?-1:0);
        if(targetR>=0 && targetR<game.size && targetC>=0 && targetC<game.size){
            swapGemsAnimated(r,c,targetR,targetC,gemSize);
        }
        isDragging=false;
    }
    el.addEventListener('mouseup', endDrag);
    el.addEventListener('mouseleave', endDrag);
    el.addEventListener('touchend', endDrag);
    el.addEventListener('touchcancel', endDrag);
}

// Swap gems with smooth animation
function swapGemsAnimated(r1,c1,r2,c2,gemSize){
    const idx1=r1*game.size+c1, idx2=r2*game.size+c2;
    const gem1 = boardEl.children[idx1], gem2 = boardEl.children[idx2];
    if(!gem1||!gem2) return;

    // Only adjacent or diagonal
    const dr=Math.abs(r1-r2), dc=Math.abs(c1-c2);
    if(dr>1||dc>1||(dr===0&&dc===0)) return;

    // Diagonal glow
    if(dr===1 && dc===1){ gem1.classList.add('diagonal-glow'); gem2.classList.add('diagonal-glow'); }

    // Slide animation
    const dx = (c2-c1)*gemSize, dy = (r2-r1)*gemSize;
    gem1.style.transition='transform 0.15s ease'; gem2.style.transition='transform 0.15s ease';
    gem1.style.transform = `translate(${dx}px, ${dy}px)`; gem2.style.transform = `translate(${-dx}px, ${-dy}px)`;

    setTimeout(()=>{
        gem1.classList.remove('diagonal-glow'); gem2.classList.remove('diagonal-glow');
        gem1.style.transition=''; gem2.style.transition='';
        gem1.style.transform=''; gem2.style.transform='';

        let t = game.board[r1][c1]; game.board[r1][c1]=game.board[r2][c2]; game.board[r2][c2]=t;
        renderBoard(); checkMatches(); game.moves--; updateDisplay();
    },160);
}

// Match checking & animations
function checkMatches(){
    let matched=[];
    for(let r=0;r<game.size;r++){ for(let c=0;c<game.size;c++){
        let g=game.board[r][c]; if(!g) continue;
        if(c<game.size-2 && g.img===game.board[r][c+1].img && g.img===game.board[r][c+2].img)
            matched.push([r,c],[r,c+1],[r,c+2]);
        if(r<game.size-2 && g.img===game.board[r+1][c].img && g.img===game.board[r+2][c].img)
            matched.push([r,c],[r+1,c],[r+2,c]);
    } }
    if(matched.length>0){ game.combo++; animateMatches(matched); } else game.combo=0;
}

function animateMatches(matched){
    matched.forEach(([r,c])=>{
        const idx=r*game.size+c;
        const gemEl=boardEl.children[idx];
        if(gemEl){ gemEl.classList.add('matched'); let rect=gemEl.getBoundingClientRect();
            spawnParticles(rect.left+rect.width/2, rect.top+rect.height/2);
        }
        game.score+=10;
    });
    updateDisplay();
    setTimeout(()=>{removeMatched(matched); dropGems(); fillEmpty(); renderBoard();},400);
}

function removeMatched(m){ m.forEach(([r,c])=> game.board[r][c]=null); }
function dropGems(){ for(let c=0;c<game.size;c++){ for(let r=game.size-1;r>=0;r--){ if(!game.board[r][c]){ for(let k=r-1;k>=0;k--){ if(game.board[k][c]){ game.board[r][c]=game.board[k][c]; game.board[k][c]=null; break; } } } } } }
function fillEmpty(){ const imgs=["gem1.png","gem2.png","gem3.png","gem4.png","gem5.png","gem6.png"];
    for(let r=0;r<game.size;r++){ for(let c=0;c<game.size;c++){ if(!game.board[r][c]){ let img=imgs[Math.floor(Math.random()*imgs.length)]; game.board[r][c]={img, rare:Math.random()<0.1}; } } } 
}
function animateValue(el,val){el.textContent=val; el.classList.add('bump'); setTimeout(()=>el.classList.remove('bump'),250); }
function updateDisplay(){ animateValue(document.getElementById("score"),game.score); animateValue(document.getElementById("moves"),game.moves); animateValue(document.getElementById("combo"),game.combo); }

document.getElementById("start-game").onclick=initGame;
document.getElementById("end-game").onclick=()=>{game.isStarted=false; alert("Game Ended. Final Score: "+game.score);}
</script>
</body>
</html>